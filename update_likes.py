from flask import Flask, redirect, url_for, session, request
from flask_oauth import OAuth
from flask_sqlalchemy import SQLAlchemy
import json
import requests
import sqlite3

post_id_array = ['116151972998_10153793681712999', '116151972998_10153793637022999', '116151972998_10153793631897999', '116151972998_10153793601707999', '116151972998_10153793570557999', '116151972998_10153793027742999', '116151972998_10153793492412999', '116151972998_10153793466772999', '116151972998_10153793000327999', '116151972998_10153793299582999', '116151972998_10153793371902999', '116151972998_10153793318057999', '116151972998_10153793296007999', '116151972998_10153793281287999', '116151972998_10153793262847999', '116151972998_10153793257847999', '116151972998_10153792773457999', '116151972998_10153792770387999', '116151972998_10153792747152999', '116151972998_10153792769622999', '116151972998_10153792730417999', '116151972998_10153792715087999', '116151972998_10153792719397999', '116151972998_10153792632392999', '116151972998_10153792635727999', '116151972998_10153792656332999', '116151972998_10153792605017999', '116151972998_10153792605832999', '116151972998_10153792605902999', '116151972998_10153792505277999', '116151972998_10153792561767999', '116151972998_10153792562457999', '116151972998_10153792529577999', '116151972998_10153792507467999', '116151972998_10153792505732999', '116151972998_10153792490997999', '116151972998_10153792481342999', '116151972998_10153792451812999', '116151972998_10153792434662999', '116151972998_10153791933792999', '116151972998_10153790802462999', '116151972998_10153791727877999', '116151972998_10153791724352999', '116151972998_10153791723282999', '116151972998_10153791725627999', '116151972998_10153791678697999', '116151972998_10153791341127999', '116151972998_10153791492752999', '116151972998_10153791668082999', '116151972998_10153791603382999', '116151972998_10153791495832999', '116151972998_10153791595752999', '116151972998_10153791581177999', '116151972998_10153791458507999', '116151972998_10153791093437999', '116151972998_10153791509182999', '116151972998_10153791491672999', '116151972998_10153791105867999', '116151972998_10153791451722999', '116151972998_10153791434297999', '116151972998_10153791350067999', '116151972998_10153791351457999', '116151972998_10153791332987999', '116151972998_10153791311932999', '116151972998_10153791312907999', '116151972998_10153791295787999', '116151972998_10153790869217999', '116151972998_10153790740752999', '116151972998_10153790729467999', '116151972998_10153790734532999', '116151972998_10153790606757999', '116151972998_10153790740432999', '116151972998_10153790725547999', '116151972998_10153790709802999', '116151972998_10153790722467999', '116151972998_10153790664572999', '116151972998_10153790612272999', '116151972998_10153790693552999', '116151972998_10153790652397999', '116151972998_10153790651417999', '116151972998_10153790651222999', '116151972998_10153790617042999', '116151972998_10153790571787999', '116151972998_10153790566667999', '116151972998_10153790566002999', '116151972998_10153790400547999', '116151972998_10153790502707999', '116151972998_10153790410082999', '116151972998_10153790418377999', '116151972998_10153790413367999', '116151972998_10153790377677999', '116151972998_10153790869217999', '116151972998_10153790740752999', '116151972998_10153790729467999', '116151972998_10153790734532999', '116151972998_10153790606757999', '116151972998_10153790740432999', '116151972998_10153790725547999', '116151972998_10153790709802999', '116151972998_10153790722467999', '116151972998_10153790664572999', '116151972998_10153790612272999', '116151972998_10153790693552999', '116151972998_10153790652397999', '116151972998_10153790651417999', '116151972998_10153790651222999', '116151972998_10153790617042999', '116151972998_10153790571787999', '116151972998_10153790566667999', '116151972998_10153790566002999', '116151972998_10153790400547999', '116151972998_10153790502707999', '116151972998_10153790410082999', '116151972998_10153790418377999', '116151972998_10153790413367999', '116151972998_10153790377677999', '116151972998_10153790869217999', '116151972998_10153790740752999', '116151972998_10153790729467999', '116151972998_10153790734532999', '116151972998_10153790606757999', '116151972998_10153790740432999', '116151972998_10153790725547999', '116151972998_10153790709802999', '116151972998_10153790722467999', '116151972998_10153790664572999', '116151972998_10153790612272999', '116151972998_10153790693552999', '116151972998_10153790652397999', '116151972998_10153790651417999', '116151972998_10153790651222999', '116151972998_10153790617042999', '116151972998_10153790571787999', '116151972998_10153790566667999', '116151972998_10153790566002999', '116151972998_10153790400547999', '116151972998_10153790502707999', '116151972998_10153790410082999', '116151972998_10153790418377999', '116151972998_10153790413367999', '116151972998_10153790377677999', '116151972998_10153789046172999', '116151972998_10153788988242999', '116151972998_10153788985132999', '116151972998_10153788946262999', '116151972998_10153788924597999', '116151972998_10153788938547999', '116151972998_10153788919002999', '116151972998_10153788902207999', '116151972998_10153788830067999', '116151972998_10153788842222999', '116151972998_10153788582192999', '116151972998_10153788768242999', '116151972998_10153788742887999', '116151972998_10153788725767999', '116151972998_10153788669377999', '116151972998_10153788648497999', '116151972998_10153788637507999', '116151972998_10153788599702999', '116151972998_10153788597117999', '116151972998_10153788529962999', '116151972998_10153788555537999', '116151972998_10153788534587999', '116151972998_10153788536202999', '116151972998_10153788513447999', '116151972998_10153788488587999', '116151972998_10153789046172999', '116151972998_10153788988242999', '116151972998_10153788985132999', '116151972998_10153788946262999', '116151972998_10153788924597999', '116151972998_10153788938547999', '116151972998_10153788919002999', '116151972998_10153788902207999', '116151972998_10153788830067999', '116151972998_10153788842222999', '116151972998_10153788582192999', '116151972998_10153788768242999', '116151972998_10153788742887999', '116151972998_10153788725767999', '116151972998_10153788669377999', '116151972998_10153788648497999', '116151972998_10153788637507999', '116151972998_10153788599702999', '116151972998_10153788597117999', '116151972998_10153788529962999', '116151972998_10153788555537999', '116151972998_10153788534587999', '116151972998_10153788536202999', '116151972998_10153788513447999', '116151972998_10153788488587999', '116151972998_10153788111662999', '116151972998_10153788002997999', '116151972998_10153788074502999', '116151972998_10153788055587999', '116151972998_10153788045547999', '116151972998_10153788002502999', '116151972998_10153787988677999', '116151972998_10153787977122999', '116151972998_10153787128397999', '116151972998_10153786995637999', '116151972998_10153787091467999', '116151972998_10153786987112999', '116151972998_10153786990457999', '116151972998_10153787071157999', '116151972998_10153787044607999', '116151972998_10153787014632999', '116151972998_10153786981417999', '116151972998_10153786960762999', '116151972998_10153786819317999', '116151972998_10153786855617999', '116151972998_10153786880162999', '116151972998_10153786868267999', '116151972998_10153786807062999', '116151972998_10153786779102999', '116151972998_10153786740567999', '116151972998_10153827156022999', '116151972998_10153827150642999', '116151972998_10153827134607999', '116151972998_10153827101842999', '116151972998_10153827065157999', '116151972998_10153827108047999', '116151972998_10153827096332999', '116151972998_10153827079832999', '116151972998_10153827068907999', '116151972998_10153827043082999', '116151972998_10153827027117999', '116151972998_10153827025852999', '116151972998_10153827024402999', '116151972998_10153826991487999', '116151972998_10153826985242999', '116151972998_10153826971372999', '116151972998_10153826490847999', '116151972998_10153826334572999', '116151972998_10153826333087999', '116151972998_10153826272397999', '116151972998_10153826224097999', '116151972998_10153826161232999', '116151972998_10153826047022999', '116151972998_10153826025632999', '116151972998_10153825936217999']




def get_number_of_likes_on_post(id):
    # url = base_url + likes + ACCESS_TOKEN
    id1 = str(id)
    url = 'https://graph.facebook.com/v2.2/' + id1 +'/likes?access_token=CAACEdEose0cBACCvsK72pdtpdojpfmmwjTfyVCNFQKWMicnFbHxVeBQjzZBnCqoxwZBjxTbrn5Mz3zeNKW3Mk5RYKkXp76RYokZAPp2WQZBcO7BGWudtVZAnOOuPCU4lYWR4vkmtEq6sjSEwzsbhqZAWiB3DAJt7nIbmZCZC9tl6ReG7LKuSuZAPnqqVQwKZCvkAMZD'
    response = requests.get(url)
    json_data = json.loads(response.text)
    likes = json_data['data']
    next_url1 = json_data['paging']['next']
    next_url = []
    count = 1
    like_count = 0
    # print next_url1
    if json_data['paging'] and 'next' in json_data['paging'].keys() and count<51:
        i = 1
    while(i):
        response = requests.get(next_url1)
        json_data = json.loads(response.text)
        likes = json_data['data']
        like_count = like_count + len(json_data['data'])
        if json_data['paging'] and 'next' in json_data['paging'].keys() and count<51:
            next_url1 = json_data['paging']['next']
            i = 1
        else:
            i = 0
            # next_url1 = 'exit'
        # next_url.append(next_url1)
        # print i
        count = count+1
    # print count
    return like_count

def update_likes():
	sqlite_file = '/home/puja/Downloads/fb-api_null'
	table_name1 = 'fb_api_test'

	conn = sqlite3.connect(sqlite_file)
	c = conn.cursor()

	# c.execute('CREATE TABLE IF NOT EXISTS fb_api_test (post_id integer, post_title text, author text, likes integer, post_link text, post_updated_time text)')

	# post_id = 1234588
	# post_title = 'aaaaghaaaaaaabb'
	# author = 'dddgfdee'
	# likes = 14
	for post_id in post_id_array:
		like = get_number_of_likes_on_post(post_id)
		likes = str(like)
		query = 'UPDATE fb_api_test SET likes=' + likes + ' WHERE post_id="' + post_id + '";'
		print query
	# i = 0
	# count1 = len(post_urls)
	# for i in range(1,count1):
	# for post_url in post_urls:
	# 	for i in range(0,25):
	# 		post_id = get_data_from_page_id(post_url, i)
	# 		post_title, author, link, time = get_author_name(post_id)
	# 		likes = get_number_of_likes_on_post(post_id)

	# 		c.execute("insert into fb_api_test(post_id, post_title, author, likes, post_link, post_updated_time) values (?,?,?,?,?,?)",(post_id, post_title, author, likes, link, time))
update_likes()