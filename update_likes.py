from flask import Flask, redirect, url_for, session, request
from flask_oauth import OAuth
from flask_sqlalchemy import SQLAlchemy
import json
import requests
import sqlite3

post_id_array = ['116151972998_10153823683427999', '116151972998_10153823604807999', '116151972998_10153823363557999', '116151972998_10153823342107999', '116151972998_10153823321692999', '116151972998_10153823291417999', '116151972998_10153823240037999', '116151972998_10153823215737999', '116151972998_10153823190462999', '116151972998_10153823135012999', '116151972998_10153823103972999', '116151972998_10153823083957999', '116151972998_10153823066602999', '116151972998_10153822890682999', '116151972998_10153822911352999', '116151972998_10153822947467999', '116151972998_10153822894752999', '116151972998_10153822901212999', '116151972998_10153822881007999', '116151972998_10153822828717999', '116151972998_10153822797917999', '116151972998_10153822781602999', '116151972998_10153822753582999', '116151972998_10153822730627999', '116151972998_10153822498657999', '116151972998_10153822663342999', '116151972998_10153822644937999', '116151972998_10153822613632999', '116151972998_10153822609367999', '116151972998_10153822588682999', '116151972998_10153822300852999', '116151972998_10153822583212999', '116151972998_10153822553102999', '116151972998_10153822510207999', '116151972998_10153822518067999', '116151972998_10153822500112999', '116151972998_10153822472707999', '116151972998_10153822453522999', '116151972998_10153822437182999', '116151972998_10153822382027999', '116151972998_10153822367112999', '116151972998_10153822343452999', '116151972998_10153822331242999', '116151972998_10153822329907999', '116151972998_10153822273592999', '116151972998_10153822260232999', '116151972998_10153822239807999', '116151972998_10153822159482999', '116151972998_10153822140737999', '116151972998_10153822097832999', '116151972998_10153822073682999', '116151972998_10153822058282999', '116151972998_10153822043157999', '116151972998_10153822019832999', '116151972998_10153821989427999', '116151972998_10153821969167999', '116151972998_10153821946987999', '116151972998_10153821927282999', '116151972998_10153821915622999', '116151972998_10153821896652999', '116151972998_10153821878687999', '116151972998_10153821821762999', '116151972998_10153821862342999', '116151972998_10153821849427999', '116151972998_10153821845977999', '116151972998_10153821835992999', '116151972998_10153821817487999', '116151972998_10153821347262999', '116151972998_10153821778667999', '116151972998_10153821171822999', '116151972998_10153821265052999', '116151972998_10153821175452999', '116151972998_10153821148952999', '116151972998_10153821106437999', '116151972998_10153821118827999', '116151972998_10153821095602999', '116151972998_10153821077597999', '116151972998_10153821049102999', '116151972998_10153821034722999', '116151972998_10153820898877999', '116151972998_10153820972427999', '116151972998_10153820946592999', '116151972998_10153820913732999', '116151972998_10153820895847999', '116151972998_10153820863677999', '116151972998_10153820861607999', '116151972998_10153820830292999', '116151972998_10153820836607999', '116151972998_10153820817307999', '116151972998_10153820791217999', '116151972998_10153820756912999', '116151972998_10153820681697999', '116151972998_10153820695277999', '116151972998_10153820685572999', '116151972998_10153820581017999', '116151972998_10153820656332999', '116151972998_10153820641017999', '116151972998_10153820582947999', '116151972998_10153820583247999', '116151972998_10153820521632999', '116151972998_10153820556982999', '116151972998_10153820446892999', '116151972998_10153820386222999', '116151972998_10153820391037999', '116151972998_10153820396972999', '116151972998_10153820349797999', '116151972998_10153820408622999', '116151972998_10153820361382999', '116151972998_10153820365407999', '116151972998_10153819703797999', '116151972998_10153820323822999', '116151972998_10153820336272999', '116151972998_10153820301262999', '116151972998_10153820286897999', '116151972998_10153820283362999', '116151972998_10153820282922999', '116151972998_10153820256437999', '116151972998_10153820209537999', '116151972998_10153820170702999', '116151972998_10153820160482999', '116151972998_10153820138987999', '116151972998_10153820117982999', '116151972998_10153820101332999', '116151972998_10153820071487999', '116151972998_10153820021542999', '116151972998_10153820038667999', '116151972998_10153820024072999', '116151972998_10153820011287999', '116151972998_10153819986672999', '116151972998_10153819980087999', '116151972998_10153819931722999', '116151972998_10153819925097999', '116151972998_10153819909297999', '116151972998_10153819896422999', '116151972998_10153819835287999', '116151972998_10153819831702999', '116151972998_10153819832132999', '116151972998_10153819816577999', '116151972998_10153819807957999', '116151972998_10153819793547999', '116151972998_10153819770767999', '116151972998_10153819756352999', '116151972998_10153819740732999', '116151972998_10153819720437999', '116151972998_10153819715522999', '116151972998_10153819712577999', '116151972998_10153819696027999', '116151972998_10153819667587999', '116151972998_10153819658802999', '116151972998_10153819641997999', '116151972998_10153819629252999', '116151972998_10153819609287999', '116151972998_10153818715192999', '116151972998_10153818588127999', '116151972998_10153818583997999', '116151972998_10153818504782999', '116151972998_10153818605862999', '116151972998_10153818497857999', '116151972998_10153818543167999', '116151972998_10153818583022999', '116151972998_10153818520322999', '116151972998_10153818534417999', '116151972998_10153818499527999', '116151972998_10153818422572999', '116151972998_10153818439902999', '116151972998_10153818414317999', '116151972998_10153818410797999', '116151972998_10153817934197999', '116151972998_10153818306757999', '116151972998_10153818313062999', '116151972998_10153818236737999', '116151972998_10153818176477999', '116151972998_10153817769217999', '116151972998_10153817777457999', '116151972998_10153818087637999', '116151972998_10153818094762999', '116151972998_10153818073902999', '116151972998_10153817873527999', '116151972998_10153818000922999', '116151972998_10153817974707999', '116151972998_10153817801907999', '116151972998_10153817939067999', '116151972998_10153817835487999', '116151972998_10153794665057999', '116151972998_10153794635712999', '116151972998_10153793087477999']



def get_number_of_likes_on_post(id):
    # url = base_url + likes + ACCESS_TOKEN
    id1 = str(id)
    url = 'https://graph.facebook.com/v2.2/' + id1 +'/likes?access_token=CAACEdEose0cBAIqP5VXBcB0qrbUOGRcI9s5Hg9mOy2G8dc355dpHe5IaD8o1CRDwqz6ZCIrkYZCjhkB0ZCjn2vbjZCdCJ7kJlXKZAgFhD5tLZC4jZCVfwzP2ZBCCDZCNOWQ3IRSZAiEKGRElqIFmmnhWfKv2AolFQ41mk0rzysD7AxbhMOfTDkZBJr9v3XrPIDDUZA7cfZC6ZAbWIMZCQZDZD'
    response = requests.get(url)
    json_data = json.loads(response.text)
    likes = json_data['data']
    next_url1 = json_data['paging']['next']
    next_url = []
    count = 1
    like_count = 0
    # print next_url1
    if json_data['paging'] and 'next' in json_data['paging'].keys() and count<51:
        i = 1
    while(i):
        response = requests.get(next_url1)
        json_data = json.loads(response.text)
        likes = json_data['data']
        like_count = like_count + len(json_data['data'])
        if json_data['paging'] and 'next' in json_data['paging'].keys() and count<51:
            next_url1 = json_data['paging']['next']
            i = 1
        else:
            i = 0
            # next_url1 = 'exit'
        # next_url.append(next_url1)
        # print i
        count = count+1
    # print count
    return like_count

def update_likes():
	sqlite_file = '/home/puja/Documents/fb-api-test/fb-api_500.db'
	table_name1 = 'fb_api_test'

	conn = sqlite3.connect(sqlite_file)
	c = conn.cursor()

	# c.execute('CREATE TABLE IF NOT EXISTS fb_api_test (post_id integer, post_title text, author text, likes integer, post_link text, post_updated_time text)')

	# post_id = 1234588
	# post_title = 'aaaaghaaaaaaabb'
	# author = 'dddgfdee'
	# likes = 14
	for post_id in post_id_array:
		like = get_number_of_likes_on_post(post_id)
		likes = str(like)
		query = 'UPDATE fb_api_test SET likes=' + likes + ' WHERE post_id="' + post_id + '";'
		print query
	# i = 0
	# count1 = len(post_urls)
	# for i in range(1,count1):
	# for post_url in post_urls:
	# 	for i in range(0,25):
	# 		post_id = get_data_from_page_id(post_url, i)
	# 		post_title, author, link, time = get_author_name(post_id)
	# 		likes = get_number_of_likes_on_post(post_id)

	# 		c.execute("insert into fb_api_test(post_id, post_title, author, likes, post_link, post_updated_time) values (?,?,?,?,?,?)",(post_id, post_title, author, likes, link, time))
update_likes()